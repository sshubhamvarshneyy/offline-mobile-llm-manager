# P0 E2E: Model Uninstall
# Tests deleting a downloaded model
#
# Precondition: At least one model downloaded
# Test: Go to Models tab → Delete model → Verify removed
# Postcondition: Model removed from downloaded list

appId: ai.offgridmobile
name: "P0: Model Uninstall"
tags:
  - p0
  - model-uninstall
---

# ==============================
# Launch app
# ==============================
- evalScript: "${console.log('UNINSTALL - Launch')}"
- launchApp

- extendedWaitUntil:
    notVisible:
      id: "app-loading"
    timeout: 30000
- evalScript: "${console.log('UNINSTALL - App ready')}"

# ==============================
# Skip onboarding if needed
# ==============================
- runFlow:
    when:
      visible:
        text: "Welcome to Off Grid"
    commands:
      - evalScript: "${console.log('UNINSTALL - Skip onboarding')}"
      - tapOn:
          text: "Skip"
      - extendedWaitUntil:
          visible:
            text: "Skip for Now"
          timeout: 30000
      - tapOn:
          text: "Skip for Now"

- runFlow:
    when:
      visible:
        text: "Download Your First Model"
    commands:
      - evalScript: "${console.log('UNINSTALL - Skip prompt')}"
      - tapOn:
          text: "Skip for Now"

# ==============================
# Wait for home screen
# ==============================
- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 15000
- evalScript: "${console.log('UNINSTALL - On home')}"
- takeScreenshot: 01-home

# ==============================
# Ensure at least one model exists (precondition)
# ==============================
# Just run setup to ensure a model is downloaded
- runFlow: 00-setup-model.yaml

# ==============================
# Navigate to Models screen
# ==============================
- evalScript: "${console.log('UNINSTALL - Go to Models')}"
- tapOn:
    text: "Models"

- extendedWaitUntil:
    visible:
      id: "models-screen"
    timeout: 10000
- takeScreenshot: 02-models-screen


# ==============================
# Tap downloads icon in top right
# ==============================
- evalScript: "${console.log('UNINSTALL - Tap downloads icon')}"
- tapOn:
    id: "downloads-icon"

# Wait for Download Manager screen
- extendedWaitUntil:
    visible:
      id: "downloaded-models-screen"
    timeout: 10000
- takeScreenshot: 03-downloads-screen

# ==============================
# Test: Delete first downloaded model
# ==============================
- evalScript: "${console.log('UNINSTALL - Tap delete icon')}"
- tapOn:
    index: 0
    id: "delete-model-button"
- takeScreenshot: 04-delete-confirm

# Confirm deletion
- extendedWaitUntil:
    visible:
      text: "Delete"
    timeout: 5000
- evalScript: "${console.log('UNINSTALL - Confirm delete')}"
- tapOn:
    text: "Delete"

# ==============================
# Verify deletion
# ==============================
- evalScript: "${console.log('UNINSTALL - Verify deleted')}"
- takeScreenshot: 09-after-delete

- evalScript: "${console.log('UNINSTALL - PASSED')}"
- takeScreenshot: 99-complete
