# P0 E2E: Image Model Uninstall
# Tests deleting a downloaded image model via Download Manager
# Assumes an image model is already downloaded

appId: ai.offgridmobile
name: "P0: Image Model Uninstall"
tags:
  - p0
  - models
  - image
---

# ==============================
# Launch and setup
# ==============================
- evalScript: "${console.log('IMG_UNINSTALL - Launch')}"
- launchApp

- extendedWaitUntil:
    notVisible:
      id: "app-loading"
    timeout: 30000

# Handle onboarding
- runFlow:
    when:
      visible:
        text: "Welcome to Off Grid"
    commands:
      - evalScript: "${console.log('IMG_UNINSTALL - Skip onboarding')}"
      - tapOn:
          text: "Skip"
      - extendedWaitUntil:
          visible:
            text: "Skip for Now"
          timeout: 30000
      - tapOn:
          text: "Skip for Now"

# Handle download prompt
- runFlow:
    when:
      visible:
        text: "Download Your First Model"
    commands:
      - evalScript: "${console.log('IMG_UNINSTALL - Skip prompt')}"
      - tapOn:
          text: "Skip for Now"

# Wait for home screen
- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 15000
- evalScript: "${console.log('IMG_UNINSTALL - On home')}"

# ==============================
# Delete image model
# ==============================
- evalScript: "${console.log('IMG_UNINSTALL - Go to Models screen')}"
- tapOn:
    text: "Models"

- extendedWaitUntil:
    visible:
      id: "models-screen"
    timeout: 10000

# Switch to Image Models tab
- evalScript: "${console.log('IMG_UNINSTALL - Image Models tab')}"
- tapOn:
    text: "Image Models"

# Open Download Manager
- evalScript: "${console.log('IMG_UNINSTALL - Open Download Manager')}"
- tapOn:
    id: "downloads-icon"

- extendedWaitUntil:
    visible:
      id: "downloaded-models-screen"
    timeout: 10000

# Find the first image model and delete it
- evalScript: "${console.log('IMG_UNINSTALL - Delete first image model')}"
- tapOn:
    id: "delete-model-button"
    index: 0

# Confirm deletion
- extendedWaitUntil:
    visible:
      text: "Delete Image Model"
    timeout: 5000
- tapOn:
    text: "DELETE"

# Wait for deletion confirmation to disappear
- evalScript: "${console.log('IMG_UNINSTALL - Waiting for deletion...')}"
- extendedWaitUntil:
    notVisible:
      text: "Delete Image Model"
    timeout: 10000

- evalScript: "${console.log('IMG_UNINSTALL - PASSED')}"
