# P0 E2E: Image Model Download
# Tests downloading an image model from the Models screen
# Assumes no image model is currently downloaded

appId: ai.offgridmobile
name: "P0: Image Model Download"
tags:
  - p0
  - models
  - image
---

# ==============================
# Launch and setup
# ==============================
- evalScript: "${console.log('IMG_DOWNLOAD - Launch')}"
- launchApp

- extendedWaitUntil:
    notVisible:
      id: "app-loading"
    timeout: 30000

# Handle onboarding
- runFlow:
    when:
      visible:
        text: "Welcome to Off Grid"
    commands:
      - evalScript: "${console.log('IMG_DOWNLOAD - Skip onboarding')}"
      - tapOn:
          text: "Skip"
      - extendedWaitUntil:
          visible:
            text: "Skip for Now"
          timeout: 30000
      - tapOn:
          text: "Skip for Now"

# Handle download prompt
- runFlow:
    when:
      visible:
        text: "Download Your First Model"
    commands:
      - evalScript: "${console.log('IMG_DOWNLOAD - Skip prompt')}"
      - tapOn:
          text: "Skip for Now"

# Wait for home screen
- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 15000
- evalScript: "${console.log('IMG_DOWNLOAD - On home')}"

# ==============================
# Download image model
# ==============================
- evalScript: "${console.log('IMG_DOWNLOAD - Go to Models screen')}"
- tapOn:
    text: "Models"

- extendedWaitUntil:
    visible:
      id: "models-screen"
    timeout: 10000

# Switch to Image Models tab
- evalScript: "${console.log('IMG_DOWNLOAD - Image Models tab')}"
- tapOn:
    text: "Image Models"
- takeScreenshot: 01-image-models-tab

# Wait for models to load
- extendedWaitUntil:
    visible:
      text: "Absolute Reality (CPU)"
    timeout: 5000
# Tap download button (1st card = index 0)
- evalScript: "${console.log('IMG_DOWNLOAD - Tap Download')}"
- tapOn:
    text: "Download"
    index: 0

# Wait for download to complete
- evalScript: "${console.log('IMG_DOWNLOAD - Waiting for download...')}"
- extendedWaitUntil:
    visible:
      text: "Success"
    timeout: 180000

- evalScript: "${console.log('IMG_DOWNLOAD - Download complete!')}"
- takeScreenshot: 02-download-complete
- tapOn:
    text: "OK"

- evalScript: "${console.log('IMG_DOWNLOAD - PASSED')}"
